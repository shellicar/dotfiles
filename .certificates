#!/bin/sh

# ZScaler

set_linux_certs() {
    # echo "Setting certs for Linux"
    # export NODE_EXTRA_CA_CERTS=/etc/ssl/certs/combined-certs.pem;
    export NODE_EXTRA_CA_CERTS=/etc/ssl/certs/ca-certificates.crt
    export REQUESTS_CA_BUNDLE=/etc/ssl/certs/ca-certificates.crt
}

set_macos_certs() {
    # echo "Setting certs for macOS"
    export NODE_EXTRA_CA_CERTS="$(brew --prefix)/etc/ca-certificates/cert.pem"
    export REQUESTS_CA_BUNDLE="$(brew --prefix)/etc/ca-certificates/cert.pem"
    # Zscaler Root CA has Basic Constraints not marked critical,
    # which fails OpenSSL 3.x strict validation (used by az cli).
    # See zscaler_verify/ for proof.
    export AZURE_CLI_DISABLE_CONNECTION_VERIFICATION=1
}

OS=$(uname)

case $OS in
Linux)
    set_linux_certs
    ;;
Darwin)
    set_macos_certs
    ;;
*)
    echo "Ignoring: $OS"
    ;;
esac

# ZScaler end
